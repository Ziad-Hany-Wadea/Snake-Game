(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8099],{63431:function(e,n,t){"use strict";t.d(n,{Z:function(){return v}});var r=t(34051),o=t.n(r),a=t(54098),c=t.n(a),i=t(31917);function u(e,n,t,r,o,a,c){try{var i=e[a](c),u=i.value}catch(s){return void t(s)}i.done?n(u):Promise.resolve(u).then(r,o)}function s(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function c(e){u(a,r,o,c,i,"next",e)}function i(e){u(a,r,o,c,i,"throw",e)}c(void 0)}))}}function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function f(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){l(e,n,t[n])}))}return e}function p(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var d=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/;function v(e){return g.apply(this,arguments)}function g(){return(g=s(o().mark((function e(n){var t,r,a,u,s,l,v,g;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.url,r=p(n,["url"]),e.prev=2,e.next=5,c()(t,{credentials:"same-origin",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},method:"post",body:JSON.stringify(f({},r,{format:"pbuf"}))});case 5:a=e.sent,e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(2),e.t0.statusCode=504,e.t0;case 12:if(a.ok){e.next=28;break}if(!(s=a.headers.get("content-type"))||!s.includes("application/json")){e.next=22;break}return e.next=18,a.json();case 18:l=e.sent,u=l.message,e.next=25;break;case 22:return e.next=24,a.text();case 24:u=e.sent;case 25:throw(v=new Error(u||a.statusText)).statusCode=a.status,v;case 28:return e.next=30,a.json();case 30:if((g=e.sent).token.startsWith("v2.public.")||d.test(g.token)){e.next=33;break}throw new i.Z("Expected token to be PASETO- or base64-encoded").setExtras(f({connectionMetadata:g,url:t},r));case 33:return e.abrupt("return",g);case 34:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}},53572:function(e,n,t){"use strict";t.d(n,{u:function(){return i}});var r=t(34051),o=t.n(r);function a(e,n,t,r,o,a,c){try{var i=e[a](c),u=i.value}catch(s){return void t(s)}i.done?n(u):Promise.resolve(u).then(r,o)}function c(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var c=e.apply(n,t);function i(e){a(c,r,o,i,u,"next",e)}function u(e){a(c,r,o,i,u,"throw",e)}i(void 0)}))}}function i(){return u.apply(this,arguments)}function u(){return(u=c(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof document){e.next=2;break}return e.abrupt("return");case 2:if(document.hidden){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",new Promise((function(e){var n=function(){document.hidden||(document.removeEventListener("visibilitychange",n),e())};document.addEventListener("visibilitychange",n)})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},27754:function(e,n,t){"use strict";t.d(n,{e:function(){return k.e},Z:function(){return G}});var r=t(34051),o=t.n(r),a=t(68944),c=t(92876);function i(e,n,t,r,o,a,c){try{var i=e[a](c),u=i.value}catch(s){return void t(s)}i.done?n(u):Promise.resolve(u).then(r,o)}function u(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function c(e){i(a,r,o,c,u,"next",e)}function u(e){i(a,r,o,c,u,"throw",e)}c(void 0)}))}}function s(e){return l.apply(this,arguments)}function l(){return(l=u(o().mark((function e(n){var t,r,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.client,r=n.args,a=n.env,e.abrupt("return",new Promise((function(e){var n=t.openChannel({service:"exec"},(function(t){var o=t.error,c=t.channel;if(o)e({error:o.message,output:null});else{if(!c)throw new Error("Expected channel");var i="";c.onCommand((function(e){e.output&&(i+=e.output)})),c.request({exec:{args:r,env:a}}).then((function(t){t.channelClosed?e({error:"Channel closed",output:i||null}):("open"===c.status&&n(),t.error?e({error:t.error,output:i||null}):e({output:i,error:null}))}))}}))})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var f=t(87152),p=t(21),d=t(63431),v=t(11163),g=t.n(v),h=t(56603),w=t(34155);function b(e,n,t,r,o,a,c){try{var i=e[a](c),u=i.value}catch(s){return void t(s)}i.done?n(u):Promise.resolve(u).then(r,o)}function m(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function c(e){b(a,r,o,c,i,"next",e)}function i(e){b(a,r,o,c,i,"throw",e)}c(void 0)}))}}function y(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function C(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){y(e,n,t[n])}))}return e}var E=Boolean(w.env.CAPTCHA_EMBEDS);function O(e){return x.apply(this,arguments)}function x(){return(x=m(o().mark((function e(n){var t,r,a,c,i,u,s,l,v;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.replId,r=n.isLoggedIn,a=n.overrideClusterMetadata,c=n.retry,i=n.asViewer,f.l){e.next=3;break}throw new Error("Expected apollo client");case 3:if(u=function(e){h.kg.error("Goval connection failure",{errorMessage:e&&e.message||"unidentified failure",replId:t,reason:"captcha",context:"services"})},s=Boolean(g().query.lite||g().query.embed),l={url:"/data/repls/".concat(t,"/get_connection_metadata"),overrideClusterMetadata:a,clientVersion:"b4934a2",hCaptchaSiteKey:p.w,isEmbed:s,flags:{},retry:c||0,asViewer:i},r||s&&!E){e.next=18;break}return e.prev=7,e.next=10,(0,p.Z)();case 10:return v=e.sent,e.abrupt("return",(0,d.Z)(C({},l,{captcha:v})));case 14:return e.prev=14,e.t0=e.catch(7),u(e.t0),e.abrupt("return",O({replId:t,overrideClusterMetadata:a,retry:(c||0)+1,isLoggedIn:r}));case 18:return e.abrupt("return",(0,d.Z)(l));case 19:case"end":return e.stop()}}),e,null,[[7,14]])})))).apply(this,arguments)}var k=t(56700),N=t(75944),P=t(67003),T=t(53572),S=t(31917),I=t(87449),M=t(56834),j=t(25108);function A(e,n,t,r,o,a,c){try{var i=e[a](c),u=i.value}catch(s){return void t(s)}i.done?n(u):Promise.resolve(u).then(r,o)}function _(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function c(e){A(a,r,o,c,i,"next",e)}function i(e){A(a,r,o,c,i,"throw",e)}c(void 0)}))}}function D(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function L(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){D(e,n,t[n])}))}return e}function R(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var Z;function G(e){var n=e.onUnrecoverableError,t=(0,N.ZP)();t.setMaxListeners(1e3);var r=null,i=k.e.DISCONNECTED,u=function(e){i!==e&&(i=e,t.emit(Z.CONNECTION_STATE_CHANGE,i))},l=function(){var e,n=function(){e&&(e(),e=void 0)};return{register:function(t,r){n();var o=t,a=r;return window.addEventListener("online",o),window.addEventListener("offline",a),e=function(){window.removeEventListener("online",o),window.removeEventListener("offline",a)},n},unregister:n}}(),f=l.register,p=l.unregister,d=new a.KU;d.onDebugLog((function(e){if("breadcrumb"===e.type){var n;n="containerState"===e.message?{containerState:e.data}:"data"in e?e.data:void 0,c.n_({category:"crosisV6",message:e.message,data:n});var t={replId:null===r||void 0===r?void 0:r.repl.id,language:null===r||void 0===r?void 0:r.repl.language},o="crosis ".concat(e.message);switch(e.message){case"connect timeout":h.kg.error(o,t);break;case"retrying":var a=e.data,i=a.error,u=R(a,["error"]),s=L({errorMessage:i.message},t,u);h.kg.error(o,s);break;case"unrecoverable error":var l=L({errorMessage:e.data.message},t);h.kg.error(o,l);break;case"connecting":case"reconnecting":case"polling fallback":h.kg.info(o,L({},t,"data"in e?e.data:void 0))}}}));var v=window.location.search.includes("debug=1");return v&&d.onDebugLog((function(e){"log"===e.type&&j.log("in"===e.log.direction?"--\x3e":"<--",e.log.cmd)})),{onPortOpened:function(e){return t.on(Z.PORT_OPEN,e),function(){t.removeListener(Z.PORT_OPEN,e)}},onToast:function(e){return t.on(Z.TOAST,e),function(){t.removeListener(Z.TOAST,e)}},onConnectionStateChanged:function(e){return t.on(Z.CONNECTION_STATE_CHANGE,e),function(){t.removeListener(Z.CONNECTION_STATE_CHANGE,e)}},connect:function(e){var c=this,s=e.context,l=e.customConnectionMetadata,p=e.fetchConnectionMetadataExtras,g=R(e,["context","customConnectionMetadata","fetchConnectionMetadataExtras"]);r=s,i!==k.e.DISCONNECTED&&d.close();var w=null;f((function(){c.connect(L({context:s,customConnectionMetadata:l,fetchConnectionMetadataExtras:p},g))}),(function(){c.close()}));var b=this,m=function(){var e=_(o().mark((function e(n){var t,r,a,c,i,u,f,d;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.chan0,r=n.gurl,a=n.shouldLogPeriodically,c=n.shouldReconnectNoResponse,i=n.isFirst,"open"===t.status){e.next=3;break}return e.abrupt("return");case 3:return u=h.kg.timeStart({gurl:r}),f=setTimeout((function(){h.kg.error("ping with no response",{gurl:r,shouldReconnectNoResponse:c}),c&&b.connect(L({context:s,customConnectionMetadata:l,fetchConnectionMetadataExtras:p},g))}),3e4),e.next=7,t.request({ping:{}});case 7:if(d=e.sent.channelClosed,clearTimeout(f),!d){e.next=11;break}return e.abrupt("return");case 11:i?u("latency to pid1",{type:"startup"}):a&&u("latency to pid1",{type:"periodic"}),setTimeout((function(){return m({chan0:t,gurl:r,shouldLogPeriodically:a,shouldReconnectNoResponse:c,isFirst:!1})}),1e3);case 13:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),y={context:s,reuseConnectionMetadata:!0,fetchConnectionMetadata:function(){var e=_(o().mark((function e(n){var t,r,c,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return window.performance.clearMarks(h.Iy.fetchConnectionMetadataPageInvisibleStart),window.performance.clearMarks(h.Iy.fetchConnectionMetadataPageInvisibleEnd),t=h.kg.timeStart(),window.performance.mark(h.Iy.fetchConnectionMetadataPageInvisibleStart),e.next=7,(0,T.u)();case 7:window.performance.mark(h.Iy.fetchConnectionMetadataPageInvisibleEnd),t("page visible fetch connection metadata");case 9:return e.next=11,(0,I.Z)();case 11:if(r=e.sent,!n.aborted){e.next=14;break}return e.abrupt("return",{error:a.gS.Aborted});case 14:if(r||!l||w===l.token){e.next=17;break}return w=l.token,e.abrupt("return",L({},l,{error:null}));case 17:if(c=h.kg.timeStart({hasCustomFetch:Boolean(g.fetchConnectionMetadata)}),e.prev=19,!g.fetchConnectionMetadata){e.next=26;break}return e.next=23,g.fetchConnectionMetadata();case 23:i=e.sent,e.next=29;break;case 26:return e.next=28,O(L({asViewer:s.asViewer,replId:s.repl.id,isLoggedIn:Boolean(s.currentUser),overrideClusterMetadata:r},p));case 28:i=e.sent;case 29:e.next=40;break;case 31:if(e.prev=31,e.t0=e.catch(19),!n.aborted){e.next=35;break}return e.abrupt("return",{error:a.gS.Aborted});case 35:e.t1=e.t0&&e.t0.statusCode,e.next=400===e.t1||408===e.t1||409===e.t1||429===e.t1||500===e.t1||502===e.t1||503===e.t1||504===e.t1?38:39;break;case 38:return e.abrupt("return",{error:a.gS.Retriable});case 39:throw e.t0;case 40:if(!n.aborted){e.next=42;break}return e.abrupt("return",{error:a.gS.Aborted});case 42:return v&&j.log("connecting",i),c("fetched connection metadata"),e.abrupt("return",L({},i,{error:null}));case 45:case"end":return e.stop()}}),e,null,[[19,31]])})));return function(n){return e.apply(this,arguments)}}(),pollingHost:"gp-v2.replit.com"};"firewalledreplit.com"===(null===window||void 0===window?void 0:window.location.hostname)&&(y.pollingHost="gp-v2.firewalledreplit.com");var C=window.performance.now(),E=0;d.open(y,(function(e){var o,a,c,i=e.channel;if(e.error)return u(k.e.DISCONNECTED),function(){};if(!i)throw new Error("Expected channel");v&&j.log("connected",{replId:s.repl.id});var l=i.onCommand((function(e){switch(e.body){case"portOpen":if(!e.portOpen)throw new Error("portOpen only handles portOpen commands");if(!e.portOpen.forwarded)return;var r=e.portOpen.port||0;if(5901===r)return;(0,M.j)(M.U3.PORT_OPENED,{port:r,isVnc:5900===r}),t.emit(Z.PORT_OPEN,{port:r,isVnc:5900===r});break;case"protocolError":var o,a;n(new S.Z("goval panic").setExtra("message",null!==(a=null===(o=e.protocolError)||void 0===o?void 0:o.text)&&void 0!==a?a:"protocol error"));break;case"toast":var c,i=null===(c=e.toast)||void 0===c?void 0:c.text;if(!i)break;t.emit(Z.TOAST,i)}}));m({chan0:i,gurl:null===(o=d.getConnectionMetadata())||void 0===o?void 0:o.gurl,shouldLogPeriodically:null===(a=s.currentUser)||void 0===a?void 0:a.flagPid1Ping,shouldReconnectNoResponse:null===(c=s.currentUser)||void 0===c?void 0:c.flagNoPongReconnect,isFirst:!0}),window.v6ws=d.ws;var f=s.repl,p=f.id,g=f.language,w=window.performance.now()-C;return h.kg.info("connected to pid1",{time:w,reconnectCount:E,replId:p,language:g}),u(k.e.CONNECTED),function(e){var n=e.willReconnect;if(l(),!n)return r=null,void u(k.e.DISCONNECTED);C=window.performance.now(),E++,u(k.e.CONNECTING)}})),u(k.e.CONNECTING)},openChannel:function(e,t){return d.openChannel(e,(function(e){var r,o=null===e||void 0===e||null===(r=e.channel)||void 0===r?void 0:r.onCommand((function(e){var t,r;"protocolError"===e.body&&n(new S.Z("goval panic").setExtra("message",null!==(r=null===(t=e.protocolError)||void 0===t?void 0:t.text)&&void 0!==r?r:"protocol error"))})),a=t(e);return function(e){a&&a(e),o&&o()}}))},getConnectionState:function(){return i},exec:_(o().mark((function e(){var n,t,r,a=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=a.length,t=new Array(n),r=0;r<n;r++)t[r]=a[r];return e.abrupt("return",s({client:d,args:t}));case 2:case"end":return e.stop()}}),e)}))),execWithEnv:function(){var e=_(o().mark((function e(n){var t,r,a,c=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=c.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=c[a];return e.abrupt("return",s({client:d,args:r,env:n}));case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),close:function(){i!==k.e.DISCONNECTED&&d.close()},destroy:function(){d.destroy(),t.removeAllListeners(),p()},client:function(){return d},getConnectionMetadata:function(){return d.getConnectionMetadata()},getContext:function(){return r},getVncUrl:function(){var e=d.getConnectionMetadata();if(!e||i!==k.e.CONNECTED)throw new Error("Cannot get vnc url when container is not connected");return(0,P.d)(e.token)},unrecoverableError:function(e,r){d.destroy(),t.removeAllListeners(),n(r?S.Z.wrap(e).setExtras(r):e)}}}!function(e){e.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",e.PORT_OPEN="PORT_OPEN",e.TOAST="TOAST"}(Z||(Z={}))},56700:function(e,n,t){"use strict";var r;t.d(n,{e:function(){return r}}),function(e){e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e.DISCONNECTED="DISCONNECTED"}(r||(r={}))},87449:function(e,n,t){"use strict";t.d(n,{Z:function(){return p},t:function(){return f}});var r=t(34051),o=t.n(r),a=t(44894),c=(t(54098),t(25108));function i(e,n,t,r,o,a,c){try{var i=e[a](c),u=i.value}catch(s){return void t(s)}i.done?n(u):Promise.resolve(u).then(r,o)}function u(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function c(e){i(a,r,o,c,u,"next",e)}function u(e){i(a,r,o,c,u,"throw",e)}c(void 0)}))}}function s(){return l.apply(this,arguments)}function l(){return(l=u(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.Z.get("gurl")){e.next=3;break}return c.log("Getting gurl from localstorage"),e.abrupt("return",a.Z.get("gurl"));case 3:e.next=5;break;case 5:return e.abrupt("return",null);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){var n=function(e){var n;try{n=new URL(e)}catch(r){return c.log("failed to parse gurl"),c.error(r),null}var t={secure:!1,port:""+n.port,host:n.hostname};return"wss:"===n.protocol?t.secure=!0:"ws:"!==n.protocol&&c.log(e,"Expected gurl protocol to be ws or wss, assuming insecure connection"),t.port||(t.port=t.secure?"443":"80"),t}(e);if(!n)return null;var t=n.secure,r=n.host,o=n.port;return"eval.repl.it"===r||"gp-v2.replit.com"===r||"gp-v2.firewalledreplit.com"===r||"eval.replit.com"===r?null:{id:"development",gurl:"ws".concat(t?"s":"","://").concat(r,":").concat(o),conmanURL:"http".concat(t?"s":"","://").concat(r,":").concat(o),proxy:"http".concat(t?"s":"","://").concat(r.replace("eval","proxy"),":").concat(o)}}function p(){return d.apply(this,arguments)}function d(){return(d=u(o().mark((function e(){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s();case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return e.abrupt("return",f(n));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},67003:function(e,n,t){"use strict";t.d(n,{d:function(){return u},h:function(){return i}});var r=t(50055),o=t(34155),a=t(48764).Buffer,c=o.env.PROXY_SUFFIX||"repl.co";function i(e){var n=e.split(".");if(4!==n.length)throw new Error("Invalid token: should have exactly 4 parts: "+e);for(var t=n[2].replace(/-/g,"+").replace(/_/g,"/");t.length%4;)t+="=";var o=window.atob(t);if(o.length<64)throw new Error("Invalid token: signed part is too short: "+o.length);var c=o.substring(0,o.length-64);try{return r.api.ReplToken.decode(new a(c,"base64"))}catch(i){return JSON.parse(window.atob(c))}}function u(e){var n=i(e).repl,t=n.user,r=n.slug,o=n.id,a="".concat(r,"--").concat(t);return a.length>63&&(a="".concat(o,".id")),-1!==c.indexOf("repl.localhost:8080")?"ws://".concat(a,".").concat(c):"wss://".concat(a,".").concat(c)}},77020:function(){}}]);
//# sourceMappingURL=8099-eaefa87934dde2ee.js.map